@{
    ViewData["Title"] = "New Wiki Page";
}

<style>
    img {
        border: 1px solid #ddd; /* Gray border */
        border-radius: 4px; /* Rounded border */
        padding: 5px; /* Some padding */
        width: 150px; /* Set a small width */
    }

    .borderless td, .borderless th {
        border: none;
    }
</style>

<p>Add New Wiki Page to @(Model.CampaignName)</p>
<div class="row">
    <div class="col-sm-9 text-dark">
        <textarea class="form-control" id="areaInputWiki" rows="5" cols="50" placeholder="In the days of old..."></textarea>
    </div>
    <div class="col-sm-3">
        <div class="card border-0 shadow" style="width: 21rem; background-color: #121212;">
            <div class="card-header">
                <input id="inputPageName" class="form-control mb-3" type="text" placeholder="Enter Page Title" />
            </div>
            <div class="custom-file">
                <input type="file" class="custom-file-input" id="fileInput">
                <label class="custom-file-label" for="customFile">Choose file</label>
            </div>
            <div class="card-body">
                <p>Other details</p>
            </div>
        </div>
    </div>
</div>
<input id="hiddenCampaignId" class="d-none" value="@(Model.CampaignID)" />
<input id="hiddenWikiPageId" class="d-none" value="@(Model.WikiPageID)" />

<button class="btn btn-secondary" id="btnSubmitWiki">Submit</button>

<script>

    $(document).ready(function () {
        let editor;
        let formData = new FormData();

        ClassicEditor
            .create(document.querySelector('#areaInputWiki'))
            .then(newEditor => {
                editor = newEditor;
            })
            .catch(error => {
                console.error(error);
            });

        document.querySelector('#btnSubmitWiki').addEventListener('click', () => {

            let fileInput = document.getElementById("fileInput");
            formData.append("wikiPageID", $("#hiddenWikiPageId").val());
            formData.append("campaignID", $("#hiddenCampaignId").val());
            formData.append("pageName", $("#inputPageName").val());
            formData.append("wikiContent", editor.getData());
            formData.append("wikiContent", fileInput.files[0]);

            fetch("api/WikiPage", {
                method: 'POST',
                body: formData
            })
                .then(() => location.reload())
                .catch(error => console.error('Unable to create wikiPage', error));
        });
    });
</script>
